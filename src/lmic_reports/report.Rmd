---
title: ""
header-includes: \usepackage{caption}
date: ""
output:
  html_document:
    keep_md: no
  pdf_document: default
  word_document:
    df_print: kable
    fig_caption: yes
    fig_height: 4
    fig_width: 6
    highlight: tango
    reference_docx: template.docx
---

```{r, echo = FALSE, message=FALSE, warning=FALSE}
start <- 10
library(dplyr)
library(ggplot2)
```

# MRC Centre for Global Infectious Disease Analysis, Imperial College London
## Situation Report for COVID-19: `r country`
## `r format(Sys.Date(), "%d/%m/%Y")`.

```{r ecdc prep, echo = FALSE, collapse=TRUE, warning=FALSE}

ecdc <- readRDS("ecdc_all.rds")
df <- ecdc[ecdc$Region == country,]

data <- df[,c("dateRep", "deaths", "cases")]
names(data)[1] <- "date"

data$deaths <- rev(cumsum(rev(data$deaths)))
data$cases <- rev(cumsum(rev(data$cases)))

pop <- get_population(country)
init <- squire:::init_check_explicit(init = NULL, population = pop$n)
init$S <- init$S + rowSums(init[,c("IMild", "ICase1", "ICase2")])
init[,c("IMild", "ICase1", "ICase2")] <- 0
init$E1[sample(length(init$E1), 1, replace = FALSE)] <- 1
init$S[init$E1 == 1] <- init$S[init$E1 == 1] - 1 

out <- squire::calibrate(data = data, country = country, replicates = 100)

```

### Epidemiological Situation

As of `r format(Sys.Date(), "%d/%m/%Y")` there have been `r data$cases[1]` cases and `r data$deaths[1]` deaths reported. The figure below shows the trajectory in deaths to date. The reports are plotted on a log-scale â€“ with the dotted lines indicating the doubling times. 

```{r fig1, echo = FALSE, collapse=TRUE, warning = FALSE}

cumulative_deaths_plot(country = country)

```

We assume that the deaths reported to date provide a good indication of the stage of the epidemic. We use these data, combined with estimates of the typical times between infection, onset of symptoms and death, and the infection fatality ratio, to estimate the epidemic state in the past. The figure below shows the estimated number of people infected and number of symptomatic cases over the past 4 weeks.

```{r case plot, echo = FALSE, collapse=TRUE, warning=FALSE}

plot(out, what = "cases") + xlim(c(Sys.Date() - 28, Sys.Date()))

```

### Short-term Epidemic Projections

The figure below gives projections of the number of symptomatic cases, the number of severe cases (requiring hospitalisation) and the number of cases requiring critical care facilities for the next 2 weeks. We note that these projections are uncertain and may be influenced by any interventions that are employed. 

```{r healthcare plots, echo = FALSE, collapse=TRUE, warning=FALSE, message=FALSE}

plot(out, what = "healthcare", forecast = 14) + 
  xlim(c(Sys.Date() - 14, Sys.Date() + 14))

```